name: üöÄ CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 8 * * *'  # –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 8:00
    - cron: '0 20 * * *' # –ö–∞–∂–¥—ã–π –≤–µ—á–µ—Ä –≤ 20:00
  workflow_dispatch:      # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          pip install -r requirements.txt
          
      - name: üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        run: |
          python -m pytest tests/ -v

  telegram-notification:
    runs-on: ubuntu-latest
    needs: test
    if: success()
    steps:
      - uses: actions/checkout@v4
      
      - name: üì® –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            ‚úÖ *–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!*
            
            üìä *–î–µ—Ç–∞–ª–∏:*
            ‚Ä¢ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}
            ‚Ä¢ –í–µ—Ç–∫–∞: ${{ github.ref }}
            ‚Ä¢ –ê–≤—Ç–æ—Ä: ${{ github.actor }}
            ‚Ä¢ –í—Ä–µ–º—è: ${{ github.event.head_commit.timestamp }}
            
            üöÄ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
          parse_mode: markdown

  daily-reminder:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    steps:
      - name: üåÖ –£—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
        if: github.event.schedule == '0 8 * * *'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            üåû *–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!*
            
            üìÖ –°–µ–≥–æ–¥–Ω—è:
            ‚Ä¢ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ - 9:00
            ‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ - 11:00
            
            üìù –ó–∞–¥–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:
            1. –°–¥–µ–ª–∞—Ç—å –î–ó –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ
            2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Å–µ–º–∏–Ω–∞—Ä—É
            
            üí™ –£–¥–∞—á–∏ –≤ —É—á—ë–±–µ!
          parse_mode: markdown
          
      - name: üåô –í–µ—á–µ—Ä–Ω–∏–π –æ—Ç—á–µ—Ç
        if: github.event.schedule == '0 20 * * *'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            üåô *–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!*
            
            üèÜ *–ò—Ç–æ–≥–∏ –¥–Ω—è:*
            ‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π: 3/5
            ‚Ä¢ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏: 4.5 —á–∞—Å–∞
            ‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ü–µ–ª—è–º: +10%
            
            üìã *–ù–∞ –∑–∞–≤—Ç—Ä–∞:*
            1. –§–∏–∑–∏–∫–∞ - –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è
            2. –ê–ª–≥–æ—Ä–∏—Ç–º—ã - –ø—Ä–æ–µ–∫—Ç
            
            üõå –•–æ—Ä–æ—à–µ–≥–æ –æ—Ç–¥—ã—Ö–∞!
          parse_mode: markdown
